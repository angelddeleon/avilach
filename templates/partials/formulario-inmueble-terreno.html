<div class="container mt-5">
    <h2 class="mb-4">Agregar Propiedad</h2>
    <div class="card">
        <div class="card-body p-4">
            <form method="POST" enctype="multipart/form-data" action="{% if terreno %}{{ url_for('main.editar_terreno', id=terreno.id) }}{% else %}{{ url_for('main.crear_terreno') }}{% endif %}">
                <div class="form-body mt-4">
                    <div class="row">
                        <div class="col-12">
                            <div class="border border-3 p-4 rounded">

                                <!-- Datos del Propietario -->
                                <h5 class="card-title">Datos del Propietario</h5>
                                <hr />
                                <div class="row g-3">
                                    <div class="col-md-4"><label>Nombre</label><input type="text" class="form-control" name="nombre" required value="{{ terreno.nombre if terreno else '' }}"></div>
                                    <div class="col-md-4"><label>Apellido</label><input type="text" class="form-control" name="apellido" required value="{{ terreno.apellido if terreno else '' }}"></div>
                                    <div class="col-md-4"><label>CI</label><input type="text" class="form-control" name="ci" required value="{{ terreno.ci if terreno else '' }}"></div>
                                    <div class="col-md-4"><label>RIF</label><input type="text" class="form-control" name="rif" value="{{ terreno.rif if terreno else '' }}"></div>
                                    <div class="col-md-4"><label>Fecha de Nacimiento</label><input type="date" class="form-control" name="fecha_nacimiento" value="{{ terreno.fecha_nacimiento.strftime('%Y-%m-%d') if terreno and terreno.fecha_nacimiento else '' }}"></div>
                                    <div class="col-md-4"><label>Estado Civil</label><input type="text" class="form-control" name="estado_civil" value="{{ terreno.estado_civil if terreno else '' }}"></div>
                                    <div class="col-md-4"><label>Email</label><input type="email" class="form-control" name="email" required value="{{ terreno.email if terreno else '' }}"></div>
                                    <div class="col-md-4"><label>Teléfono</label><input type="text" class="form-control" name="telefono" value="{{ terreno.telefono if terreno else '' }}"></div>
                                </div>

                                <!-- Título del Inmueble -->
                                <h5 class="card-title">Título del Inmueble</h5>
                                <hr />
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label>Título de Publicación</label>
                                        <input type="text" class="form-control" name="titulo_publicacion" required value="{{ terreno.titulo_publicacion if terreno else '' }}">
                                    </div>
                                    

                                    <label for="tipo_negocio" class="form-label">Tipo de Negocio</label>
                                    <div class="col-md-6">
                                        <select class="form-select" name="tipo_negocio" required>
                                            <option value="Venta" {% if terreno and terreno.tipo_negocio == 'Venta' %}selected{% endif %}>Venta</option>
                                            <option value="Alquiler" {% if terreno and terreno.tipo_negocio == 'Alquiler' %}selected{% endif %}>Alquiler</option>
                                            <option value="Venta y Alquiler" {% if terreno and terreno.tipo_negocio == 'Venta y Alquiler' %}selected{% endif %}>Venta y Alquiler</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label>Tipo de Inmueble</label>
                                        <select class="form-select" name="tipo_inmueble">
                                            <option value="Terreno" {% if terreno and terreno.tipo_inmueble == 'Terreno' %}selected{% endif %}>terreno</option>
                                        </select>
                                    </div>

                                    <h5 class="card-title mt-4">Datos del Terreno</h5>
                                <hr />
                                <div class="row g-3">
                                    <div class="col-md-3"><label>Estado</label><input type="text" class="form-control" name="estado" required value="{{ terreno.estado if terreno else '' }}"></div>
                                    <div class="col-md-3"><label>Municipio</label><input type="text" class="form-control" name="municipio" required value="{{ terreno.municipio if terreno else '' }}"></div>
                                    <div class="col-md-3"><label>Ciudad</label><input type="text" class="form-control" name="ciudad" required value="{{ terreno.ciudad if terreno else '' }}"></div>
                                    <div class="col-md-3"><label>Urbanización</label><input type="text" class="form-control" name="urbanizacion" value="{{ terreno.urbanizacion if terreno else '' }}"></div>
                                    
                                    <div class="col-md-6"><label>Descripcion</label><textarea class="form-control" name="datos_inmueble">{{ terreno.descripcion if terreno else '' }}</textarea></div>
                                    <div class="col-md-6"><label>Referencia</label><input type="text" class="form-control" name="referencia" value="{{ terreno.referencia if terreno else '' }}"></div>
            
                                </div>


                                    <div class="col-md-4">
                                        <label for="m2_terreno">m2 de Terreno</label>
                                        <input type="number" class="form-control" name="m2_terreno" required value="{{ terreno.m2_terreno if terreno else '' }}">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="m2_construccion">m2 de Construcción</label>
                                        <input type="number" class="form-control" name="m2_construccion" value="{{ terreno.m2_construccion if terreno else '' }}">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="m_frente">Frente</label>
                                        <input type="number" class="form-control" name="m_frente" value="{{ terreno.m_frente if terreno else '' }}">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="m_anch">Ancho</label>
                                        <input type="number" class="form-control" name="m_anch" value="{{ terreno.m_anch if terreno else '' }}">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="m_largo">Largo</label>
                                        <input type="number" class="form-control" name="m_largo" value="{{ terreno.m_largo if terreno else '' }}">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="cerca_perimetral">Cerca Perimetral</label>
                                        <input type="text" class="form-control" name="cerca_perimetral" value="{{ terreno.cerca_perimetral if terreno else '' }}">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="bienechurias">Bienechurias</label>
                                        <input type="text" class="form-control" name="bienechurias" value="{{ terreno.bienechurias if terreno else '' }}">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="otros">Otros</label>
                                        <input type="text" class="form-control" name="otros" value="{{ terreno.otros if terreno else '' }}">
                                    </div>
            
                                    <!-- Características adicionales (checkboxes) -->
                                    <h5 class="card-title mt-4">Materiales del Inmueble</h5>
                                    <hr />
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label for="bloques">Bloques</label>
                                            <input type="checkbox" class="form-check-input" name="materiales[]" value="Bloques" {% if terreno and terreno.materiales and 'Bloques' in terreno.materiales %}checked{% endif %}>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="alfajol">Alfajol</label>
                                            <input type="checkbox" class="form-check-input" name="materiales[]" value="Alfajol" {% if terreno and terreno.materiales and 'Alfajol' in terreno.materiales %}checked{% endif %}>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="madera">Madera</label>
                                            <input type="checkbox" class="form-check-input" name="materiales[]" value="Madera" {% if terreno and terreno.materiales and 'Madera' in terreno.materiales %}checked{% endif %}>
                                        </div>
                                    </div>
                                </div>

                                
                                <!-- Características -->
                                <h5 class="card-title mt-4">Características</h5>
                                <hr />
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label>Vías de Acceso</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="vias_acceso" value="Asfalto" {% if terreno and terreno.vias_acceso and 'Asfalto' in terreno.vias_acceso %}checked{% endif %}>
                                            <label class="form-check-label">Asfalto</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="vias_acceso" value="Tierra" {% if terreno and terreno.vias_acceso and 'Tierra' in terreno.vias_acceso %}checked{% endif %}>
                                            <label class="form-check-label">Tierra</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="vias_acceso" value="Concreto" {% if terreno and terreno.vias_acceso and 'Concreto' in terreno.vias_acceso %}checked{% endif %}>
                                            <label class="form-check-label">Concreto</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="vias_acceso" value="Arena" {% if terreno and terreno.vias_acceso and 'Arena' in terreno.vias_acceso %}checked{% endif %}>
                                            <label class="form-check-label">Arena</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="vias_acceso" value="Ripio" {% if terreno and terreno.vias_acceso and 'Ripio' in terreno.vias_acceso %}checked{% endif %}>
                                            <label class="form-check-label">Ripio</label>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <label>Formas del Terreno</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="formas_terreno" value="Regular" {% if terreno and terreno.formas_terreno and 'Regular' in terreno.formas_terreno %}checked{% endif %}>
                                            <label class="form-check-label">Regular</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="formas_terreno" value="Irregular" {% if terreno and terreno.formas_terreno and 'Irregular' in terreno.formas_terreno %}checked{% endif %}>
                                            <label class="form-check-label">Irregular</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="formas_terreno" value="Plano" {% if terreno and terreno.formas_terreno and 'Plano' in terreno.formas_terreno %}checked{% endif %}>
                                            <label class="form-check-label">Plano</label>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <label>Otros</label>
                                        <input type="text" class="form-control" name="otros_caracteristicas" value="{{ terreno.otros_caracteristicas if terreno else '' }}">
                                    </div>
                                </div>

                                <!-- Servicios Básicos -->
                                <h5 class="card-title mt-4">Servicios Básicos</h5>
                                <hr />
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="servicios_basicos" value="Aguas Blancas" {% if terreno and terreno.servicios_basicos and 'Aguas Blancas' in terreno.servicios_basicos %}checked{% endif %}>
                                            <label class="form-check-label">Aguas Blancas</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="servicios_basicos" value="Electricidad" {% if terreno and terreno.servicios_basicos and 'Electricidad' in terreno.servicios_basicos %}checked{% endif %}>
                                            <label class="form-check-label">Electricidad</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="servicios_basicos" value="Aguas Negras" {% if terreno and terreno.servicios_basicos and 'Aguas Negras' in terreno.servicios_basicos %}checked{% endif %}>
                                            <label class="form-check-label">Aguas Negras</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="servicios_basicos" value="Alta Tensión" {% if terreno and terreno.servicios_basicos and 'Alta Tensión' in terreno.servicios_basicos %}checked{% endif %}>
                                            <label class="form-check-label">Alta Tensión</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="servicios_basicos" value="Baja Tensión" {% if terreno and terreno.servicios_basicos and 'Baja Tensión' in terreno.servicios_basicos %}checked{% endif %}>
                                            <label class="form-check-label">Baja Tensión</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Zonificación -->
                                <h5 class="card-title mt-4">Zonificación</h5>
                                <hr />
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="zonificacion" value="Residencial" {% if terreno and terreno.zonificacion and 'Residencial' in terreno.zonificacion %}checked{% endif %}>
                                            <label class="form-check-label">Residencial</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="zonificacion" value="Comercial" {% if terreno and terreno.zonificacion and 'Comercial' in terreno.zonificacion %}checked{% endif %}>
                                            <label class="form-check-label">Comercial</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="zonificacion" value="Industrial" {% if terreno and terreno.zonificacion and 'Industrial' in terreno.zonificacion %}checked{% endif %}>
                                            <label class="form-check-label">Industrial</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="zonificacion" value="Educativa" {% if terreno and terreno.zonificacion and 'Educativa' in terreno.zonificacion %}checked{% endif %}>
                                            <label class="form-check-label">Educativa</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Precio -->
                                <h5 class="card-title mt-4">Precio y Comisión</h5>
                                <hr />
                                <div class="row g-3">
                                    <div class="col-md-4"><label>Precio</label><input type="number" step="0.01" class="form-control" name="precio" required value="{{ terreno.precio if terreno else '' }}"></div>
                                    <div class="col-md-4"><label>Comisión</label><input type="number" step="0.01" class="form-control" name="comision" value="{{ terreno.comision if terreno else '' }}"></div>
                                </div>

                                <!-- Documentos -->
                                <h5 class="card-title mt-4">Documentación</h5>
                                <hr />
                                <div class="row g-3">
                                    <div class="col-md-6"><label>Imagen de Cédula</label><input type="file" class="form-control" name="imagen_cedula" accept="image/*"></div>
                                    <div class="col-md-6"><label>Documento de Propiedad</label><input type="file" class="form-control" name="documento_propiedad" accept=".pdf"></div>
                                </div>

                                <h5 class="card-title">Imagenes del Inmueble</h5>

                                <div class="row g-3">
                                    <div class="col-md-12">
                                        <label>Arrastra y suelta las imágenes</label>

                                        <!-- Cuadro visual para las imágenes -->
                                        <div id="imagenes-cuadro" class="border p-3" style="min-height: 150px; display: flex; flex-wrap: wrap;">
                                            {% if terreno and terreno.imagen_principal %}
                                                {% set imagenes = terreno.imagen_principal.split(',') %}
                                                {% for img in imagenes %}
                                                    {% set img_nombre = img.strip() %}
                                                    {% if img_nombre %}
                                                        <div class="image-item border p-2 m-2 rounded" data-imagen="{{ img_nombre }}">
                                                            <img src="/static/imagenes/inmuebles/{{ img_nombre }}" alt="Imagen inmueble" style="max-width: 100px; max-height: 100px; margin-bottom: 10px;">
                                                            <input type="hidden" name="imagenes_actuales[]" value="{{ img_nombre }}">
                                                            <div class="drag-handle" style="cursor: move; text-align: center; font-size: 20px;">&#x21C5;</div>
                                                            <div class="delete-btn" onclick="eliminarImagenExistente(this, '{{ img_nombre }}')">X</div>
                                                        </div>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                        
                                        <input type="file" id="imagenes-input" class="form-control" name="imagenes" multiple accept="image/*" style="display: none;" />
                                        <button type="button" id="upload-btn" class="btn btn-primary mt-2">Seleccionar Imágenes</button>
                                    </div>
                                </div>

                                <!-- Botón -->
                                <div class="mt-4 text-end">
                                    <button type="submit" class="btn btn-primary">Guardar Terreno</button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
